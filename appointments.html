<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
  </head>
  <body onload="hideAll()">
    <? 
      var appointments = getSheetDataAsDict('Appointments');
      var url = getScriptUrl();
    ?>
    <a href='<?=url?>'>Home</a><br>
    <h1>Scheduled Appointments:</h1>
    None Yet
    <h1>Available Appointments:</h1>
    <p>Last checked: <?= new Date().toLocaleString() ?></p>

    Select Day: <input type="date" onchange="onDateSelect(this)"><br><br>
    <?
    //load appointments group by day
    days = {};
    for (var i in appointments) {
      appointment = appointments[i];
      day  = appointment['Date'];
      if (!(day in days))
        days[day] = []
      days[day].push(appointment)
    }

    for (var day in days) {
      appointments = days[day]
      appointment = appointments[0]
      ?> 
      <div id=<?=day?>>
      <b><?=day?></b><br>
      <?=appointment['Name']?><br>
      <a href="https://www.google.com/maps/search/?api=1&query=<?=appointment['Location']?>" target=new><?=appointment['Location']?></a><br>
      <select name="appointment" id="appointment">
      <option disabled selected value>select a time</option>
      <?
      for (var i in appointments) {
        appointment = appointments[i]
        time = appointment['Time']

        //format time to 12hr
        hrs = parseInt(time.split(':')[0])
        suffix = (hrs >= 12) ? " PM" : " AM"
        hrs = (hrs >= 13) ? hrs-12: hrs
        time = '' + hrs + ':' + time.split(':')[1] + suffix
        
        disabled = ''
        if (appointment['Remaining'] == 0)
          disabled = 'disabled'
        id = appointment['ID']

        ?>
        <option value="<?=id?>" <?=disabled?>><?=time?></option>
        <?

      }
      ?>
      </select></div>
      <br><br><?
    }
?>
<script>
  function hideAll(){
    <?
    for (var day in days) {
      ?>
     document.getElementById(<?=day?>).style.visibility = "hidden";
      <?
    }
    ?>
  }
  function onDateSelect(e){
    hideAll();
    console.log(e.value);
    document.getElementById(e.value).style.visibility = "visible";
  }
</script>
  </body>
</html>
