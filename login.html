<!DOCTYPE html>
<html>
  <head>
    <base target="_top" />
  </head>

  <body>
    <?var url = getScriptUrl();?>
    <?var auth_url = generateAuthUrl();?>

    <a href="<?=url?>">Home</a><br />
    <h1>Login</h1>

    <p>
      <b>Directions:</b>
      <br /><br />
      Please click the <i>login</i> button below (it will take you to the
      standard 'Sign in With Google' page)<br />
    </p>

    <a href="<?=auth_url?>" target="_blank"><button>login</button></a>

    <br /><br />
    <p>
      After you successfully login, it will provide you with an authorization
      token.<br />
      You will need to copy and paste the token in the form below.<br />
    </p>

    <form id="myform">
      <input type="hidden" name="page" value="login" />
      <input type="hidden" name="prev" value="login" />
      <label for="auth_code">Authorization Code:</label><br />
      <input type="text" id="auth_code" name="auth_code" /><br />
      <br />
      <button
        type="button"
        onclick="google.script.run.withSuccessHandler(onOauthAPIComplete).tryGetEmailWithToken(document.getElementById('auth_code').value)"
      >
        Submit</button
      ><br />
    </form>
    <br /><br />

    <div id="result"></div>
    <script>
      function onOauthAPIComplete(result) {
        console.log("Done");
        console.log(result.email);
        document.getElementById("result").innerHTML =
          "User Email: " + result.email;
        return result;
      }
    </script>
  </body>
</html>
