<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
  </head>
  <body onload="google.script.run.withSuccessHandler(onCheckInData).getCheckInDataset('2021-04-01')">
    <?var url = getScriptUrl();?>
    <a href='<?=url?>'>Home</a><br>
    <h1>Check-In (Staff Only)</h1>
    Search: <input type="text" onkeyup="onKeyUp(this)">
    <br><br>
    <div id="results"></div>
  </body>
<script>
var data;

function onKeyUp(e) {
  document.getElementById('results').innerHTML = e.value;
  showMatches(e.value);
}

function onCheckInData(result) {
  data = result
  console.log(data.length);
  showMatches('');
}

function showMatches(query) {
  query = query.toUpperCase();
  var matches = []

  // case insensivite first or last name search
  for(var i = 0; i < data.length; i++) {
    var lastName = data[i]['LastName'].toUpperCase();
    var firstName = data[i]['FirstName'].toUpperCase();
    if (lastName.includes(query) || firstName.includes(query))
      matches.push(data[i]);
  }

  if(matches.length == 0) {
    html = 'No Results';
  }
  else {
    html = '';
    for(var i in matches){
      var lastName = matches[i]['LastName'];
      var firstName = matches[i]['FirstName'];
      var status = "none";
      var waiver = 'false';
      var bgcolor = (i%2 == 0) ? '#eeeeee' : '#ffffff';
      html += "<div><table bgcolor=" + bgcolor + " width=100%><td width=300>" + lastName + ', ' + firstName + "</td>"
      html += "<td>Status:" + status + "</td>";
      html += "<td>Waiver:" + waiver + "</td>";
      html += "<td><a href='<?=url?>?page=profile&ID=" + matches[i]['ID'] + "'>Profile</a></td>";
      html += "<td><button type='button'>CheckIn</button></td>";
      html += "</table></div>"
    }
  }
  document.getElementById('results').innerHTML = html;
}

</script>
</html>
